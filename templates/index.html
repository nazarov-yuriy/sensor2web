<!DOCTYPE html>
<html>
<head>
    <title>Pendulum Animation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"
            integrity="sha512-3RlxD1bW34eFKPwj9gUXEWtdSMC59QqIqHnD8O/NoTwSJhgxRizdcFVQhUMFyTp5RwLTDL0Lbcqtl8b7bFAzog=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
<script type="text/javascript" charset="utf-8">
    let pendulum;

    function setup() {
        createCanvas(400, 400);
        pendulum = new Pendulum(width / 2, 250, 200);
    }

    function draw() {
        background(220);
        pendulum.update();
        pendulum.display();
    }

    class Pendulum {
        constructor(originX, originY, armLength) {
            this.origin = createVector(originX, originY);
            this.delta_x = 0;
            this.pos = createVector(originX, originY);
            this.armLength = armLength;
            this.angle = 0; // initial angle
            this.ballRadius = 20.0; // Arbitrary ball radius
        }

        update() {
            this.pos = createVector(this.origin.x, this.origin.y)
            this.pos.x += this.delta_x * 50
        }

        display() {
            let x = this.armLength * sin(this.angle);
            let y = this.armLength * cos(this.angle);

            stroke(0);
            strokeWeight(2);
            fill(127);
            rect(this.pos.x - this.ballRadius / 2, this.pos.y - this.ballRadius / 2, this.ballRadius, this.ballRadius);
            line(this.pos.x, this.pos.y, this.pos.x + x, this.pos.y + y);
            ellipse(this.pos.x + x, this.pos.y + y, this.ballRadius, this.ballRadius);
        }
    }

    setInterval(function () {
        httpGet('/get_state', 'json', false, function (response) {
            console.log(response);
            pendulum.angle = response.angle + PI;
            pendulum.delta_x = response.delta_x;
        });
    }, 50);
</script>
</body>
</html>